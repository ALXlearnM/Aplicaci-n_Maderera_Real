@model Maderera_Aplicacion_Web.Models.Pret02Campana

@{
    <title>@ViewData["Title"] Jhyperionm</title>
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Título de la página</title>


</head>
<body>

<div class="d-flex ml-5" style="font-size: 12px;">
    <!-- Primera fila con los botones -->
    <div class="row mb-1 justify-content-end w-100 ">
        <div class="col mb-3 mr-5">
            <img class="img-fluid" style="margin: 0.25% 3.5%;
             width: 20%;
             position: absolute;" src="~/jhyperionm.png" alt="Logo de la empresa ">
        </div>

        <div class="col mb-3 ml-3 mr-3">
            <div class="d-flex justify-content-between p-0" id="botonesbarra1">
                <button id="guardarCamp" class="btn btn-success btn-sm mr-2" role="button">Guardar</button>
                <button id="guardarycerrarCamp" class="btn btn-primary btn-sm mr-2" role="button">Guardar y Cerrar</button>
                <button id="cancelarCamp" class="btn btn-danger btn-sm" role="button">Cancelar</button>
            </div>
        </div>



            <div class="col mb-3 ml-3 mr-3">
                <div class=" d-flex justify-content-start p-0">
                    <div class="nota-pedido">
                            <p>
                            <b>

                                <div class="text-lg-center" >CODIGO CAMPAÑA</div>
                            </b>
                            </p>
                        <div class="text-sm-center"><input readonly asp-for="CodigoCampana" class="numero-pedido text-center" value="@ViewBag.CodCamp" /></div>

                    </div>
                </div>
            </div>

    </div>
</div>

<hr class="mt-3" />




@*MODAL PARA EDITAR*@
<div id="editarTAModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Campaña por tipo de Arbol</h2>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <label>Tipo den Arbol:</label>
                <input readonly id="TAinput" class="form-control">
                <input hidden id="IdEditarTA" class="form-control">
                <label for="nuevaCantidad">Nueva Cantidad de Àrboles:</label>
                <input type="number" id="nuevonroarbolTA" class="form-control">
                <label for="nuevaCantidad">Nueva Cantidad de Hectareas:</label>
                <input type="number" id="nuevanrohectareasTA" oninput="multiplicarPorMil('nuevanrohectareasTA','nuevoAreaTA')" class="form-control">
                <label for="nuevoDescuento">Nueva Area:</label>
                <input readonly type="number" id="nuevoAreaTA" class="form-control">
                <label for="nuevoDescuento">Nueva Latitud:</label>
                <input type="text" id="nuevaLatitudTA" class="form-control">
                <label for="nuevoDescuento">Nueva Longitud:</label>
                <input type="text" id="nuevaLongitudTA" class="form-control">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="aplicarCambiosTA()" data-dismiss="modal">Guardar</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>



    <div class="col">
        <div class="card">
            <div class="card-header">
                <h4>Campaña</h4>
            </div>

    <div class="card-body">
        <ul class="nav nav-tabs bg-light border-bottom-0">
            <li class="nav-item">
                <a class="nav-link text-dark active" id="regiscampana-tab" data-toggle="tab" href="#regiscampana">
                    <b>Registro</b>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-dark" id="TAcampana-tab" data-toggle="tab" href="#TAcampana">
                    <b>Tipo de árbol</b>
                </a>
            </li>
        </ul>



        <div class="tab-content">
            @* PARA LA TABLA REGISTRO DE CAMPANA*@
            <div class="tab-pane fade in active show" id="regiscampana">
                <form id="FormCampana" style="font-size: 16px;">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-4 mt-3">
                                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Nro. de Predio* :</label>
                                    <div class="col-sm-8">
                                        <label class="form-control form-control-sm">@ViewBag.NroSitio </label>
                                    </div>
                                </div>
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Tipo de Camp.* :</label>
                                    <div class="col-sm-8">
                                        <select id="IdTipoCampana" asp-for="IdTipoCampana" class="form-control form-control-sm" asp-items="ViewBag.IdTipoCampana" required></select>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-4 mt-3">
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Nro. Hectarea* :</label>
                                    <div class="col-sm-8">
                                        <input readonly id="nrohectareacampana" asp-for="NroHectarea" class="form-control form-control-sm" required />
                                        <span asp-validation-for="NroHectarea" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Área(m²)* :</label>
                                    <div class="col-sm-8">
                                        <input readonly id="areacampana" asp-for="Area" class="form-control form-control-sm" required />
                                        <span asp-validation-for="Area" class="text-danger"></span>
                                    </div>
                                </div>
                                
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Nro. de Arbol* :</label>
                                    <div class="col-sm-8">
                                        <input readonly id="nroarbolcampana" asp-for="NroArboles" class="form-control form-control-sm" required />
                                        <span asp-validation-for="NroArboles" class="text-danger"></span>
                                    </div>
                                </div>

                            </div>

                            <div class="col-md-4 mt-3">
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Fecha* :</label>
                                    <div class="col-sm-8">
                                        <input id="fechainiciocampana" asp-for="FechaInicio" class="form-control form-control-sm" required />
                                        <span asp-validation-for="FechaInicio" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Coordenada 1 :</label>
                                    <div class="col-sm-8">
                                        <input id="latitudcampana" type="text" asp-for="Latitud" class="form-control form-control-sm" />
                                        <span asp-validation-for="Latitud" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group row">
                                            <label for="colFormLabelSm" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Coordenada 2 :</label>
                                    <div class="col-sm-8">
                                        <input id="longitudcampana" type="text" asp-for="Longitud" class="form-control form-control-sm" />
                                        <span asp-validation-for="Longitud" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>

                           
                        </div>
                    </div>

                </form>

            </div>




            @* PARA LA TABLA REGISTRO CAMPANA_TIPO_ARBOL*@
            <div class="tab-pane fade" id="TAcampana">

                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-4 mt-3">
                            <div class="form-group row">
                                        <label for="tipoarboltc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Tipo de Árbol* :</label>
                                <div class="col-sm-8">
                                    <input hidden id="tipoarboltc" class="form-control" required>

                                    <select id="tarcbo" class="custom-select" data-modal-target="modaltar" onchange="SelectChange(this,'modaltar')">
                                        <option selected value="none">Seleccionar opción</option>
                                        <option value="buscar">Buscar</option>
                                    </select>
                                    <div style="display: flex; align-items: center;">
                                        <span id="TipoArbolNombre" class="spanproducto" style="display: none;"></span>
                                        <span id="removeTASpan" class="equisproducto" style="cursor: pointer; display: none; margin-left: 5px;" onclick="removeTipoArbol()">X</span>
                                    </div>
                                    <div class="modal modal-xl custom-modal" id="modaltar" tabindex="-1" role="dialog" aria-labelledby="modaltarLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="modaltarLabel">Tipo de Árbol</h5>
                                                    <button type="button" onclick="closeModal('modaltar','tarcbo')" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body custom">
                                                    <div class="client-container">
                                                        <div class="row col-lg-4">
                                                            <button type="button" class="btn btn-primary mb-3 btn-sm" onclick="openSecondModal('createTipoArbolModal')">
                                                                Añadir Nuevo Tipo arbol
                                                            </button>
                                                        </div>
                                                        <table class="tablaTipoArbol" id="tablatipoarbol">
                                                            <thead class="headTar">
                                                                <tr align="center">
                                                                    <th class="client-cell text-center">Tipo de Árbol</th>
                                                                    <th class="client-cell text-center">Opciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="bodyTipoArbol">
                                                                @foreach (var Tipoarbol in ViewBag.TipoArbol)
                                                                {
                                                                    <tr>
                                                                        <td align="center" class="client-cell">@Tipoarbol.TxtDesc</td>
                                                                        <td align="center" class="client-cell">
                                                                            <button class="btn btn-primary" onclick="seleccionarTA('modaltar','tarcbo','tipoarboltc','TipoArbolNombre','@Tipoarbol.IdTipoarbol', '@Tipoarbol.TxtDesc')">Seleccionar</button>
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" onclick="closeModal('modaltar','tarcbo')" class="btn btn-secondary">Cerrar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal fade show" id="createTipoArbolModal" tabindex="-1" role="dialog" aria-labelledby="createTipoArbolModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="createLocalizacionModalLabel">Crear Nuevo Tipo de Arbol</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body container-fluid">
                                                    <form id="createTipoArbolForm">
                                                        <div class="form-group">
                                                            <label for="Pnombre">Nombre:</label>
                                                            <input type="text" class="form-control" id="txtdesctar" placeholder="Nombre del tipo de arbol...">
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                                    <button type="button" class="btn btn-primary" id="crearTipoArbolBtn">Crear Tipo de Arbol</button>


                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                            </div>

                            <div class="form-group row">
                                        <label for="nroarboltc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Nro de árboles* :</label>
                                <div class="col-sm-8">
                                    <input type="number" id="nroarboltc" min="0" class="form-control small" />
                                </div>
                            </div>
                        </div>

                                <div class="col-md-3 mt-3">
                            <div class="form-group row">
                                        <label for="areatc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Hectareas* :</label>
                                <div class="col-sm-8">
                                    <input type="number" id="hectareastc" min="0" class="form-control small" oninput="multiplicarPorMil('hectareastc','areatc')" />
                                </div>
                            </div>
                            <div class="form-group row">
                                        <label for="areatc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Área(m²)* :</label>
                                <div class="col-sm-8">
                                    <input readonly type="number" id="areatc" min="0" class="form-control small" />
                                </div>
                            </div>

                            
                        </div>

                        <div class="col-md-3 mt-3">
                            <div class="form-group row">
                                        <label for="latitudtc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Coordenada 1:</label>
                                <div class="col-sm-8">
                                    <input type="text" id="latitudtc" class="form-control small" />
                                </div>
                            </div>
                            <div class="form-group row">
                                        <label for="longitudtc" class="col-sm-4 col-form-label col-form-label-sm extra-small text-nowrap" style="font-size:16px;">Coordenada 2:</label>
                                <div class="col-sm-8">
                                    <input type="text" id="longitudtc"class="form-control small" />
                                </div>
                            </div>
                        </div>

                        <div class="col-md-1 m-2">

                            <div class="form-group row">
                                <div class="col-sm-8">
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-sm-8">
                                    <button class="botonaddProducto btn-success" onclick="agregarCampanata()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <table align="center" border="1" cellspacing="0" class="table table-striped table-bordered" id="tablageneral">
                    <thead class="HeadTA">
                        <tr>
                            <td class="text-center">Tipo de Arbol</td>
                            <td class="text-center">Número de Arboles</td>
                            <td class="text-center">Número de Hectareas</td>
                            <td class="text-center">Area(m²)</td>
                            <td class="text-center">Coordenada 1</td>
                            <td class="text-center">Coordenada 2</td>
                            <td colspan="2" class="text-center">Opciones</td>
                        </tr>
                    </thead>
                    <tbody class="BodyTA" id="tipoArbolSeleccionados">
                    </tbody>
                </table>

             </div>
        </div>

    </div>
    </div>
    </div>

    <script>
        
        document.addEventListener("DOMContentLoaded", function () {

            var table = jQuery('#tablatipoarbol').DataTable(

                {
                    language: {
                        "decimal": "",
                        "emptyTable": "No hay información",
                        "info": "Mostrando _START_ a _END_ de _TOTAL_ Tipo de Arbol",
                        "infoEmpty": "Mostrando 0 to 0 of 0 Tipo de Arbol",
                        "infoFiltered": "(Filtrado de _MAX_ total Tipo de Arbol)",
                        "infoPostFix": "",
                        "thousands": ",",
                        "lengthMenu": "Mostrar _MENU_ Tipo de Arbol",
                        "loadingRecords": "Cargando...",
                        "processing": "Procesando...",
                        "search": "Buscar:",
                        "zeroRecords": "Sin resultados encontrados",
                        "paginate": {
                            "first": "Primero",
                            "last": "Ultimo",
                            "next": "Siguiente",
                            "previous": "Anterior"
                        }
                    }
                }
            );

            //            var table = jQuery('#tablageneral').DataTable(

            //    {
            //        language: {
            //            "decimal": "",
            //            "emptyTable": "No hay información",
            //            "info": "Mostrando _START_ a _END_ de _TOTAL_ Tipo de Arbol",
            //            "infoEmpty": "Mostrando 0 to 0 of 0 Tipo de Arbol",
            //            "infoFiltered": "(Filtrado de _MAX_ total Tipo de Arbol)",
            //            "infoPostFix": "",
            //            "thousands": ",",
            //            "lengthMenu": "Mostrar _MENU_ Tipo de Arbol",
            //            "loadingRecords": "Cargando...",
            //            "processing": "Procesando...",
            //            "search": "Buscar:",
            //            "zeroRecords": "Sin resultados encontrados",
            //            "paginate": {
            //                "first": "Primero",
            //                "last": "Ultimo",
            //                "next": "Siguiente",
            //                "previous": "Anterior"
            //            }
            //        }
            //    }






            //);

            var campana = @Html.Raw(Json.Serialize(ViewBag.Campana));
            var detalles = @Html.Raw(Json.Serialize(ViewBag.Detalles));
            var CompParsed = JSON.parse(campana);
            var detallesParsed = JSON.parse(detalles); // Convierte la cadena JSON a un objeto JavaScript
            if (CompParsed !== null) {
                console.log(CompParsed);

                $('#campanaTAIdInput').val(CompParsed.CampanaTA.IdCampana);
                $('#IdTipoCampana').val(CompParsed.CampanaTA.IdTipoCampana);
                $('#CodigoCampana').val(CompParsed.CampanaTA.CodigoCampana);
                $('#areacampana').val(CompParsed.CampanaTA.Area);

                $('#nrohectareacampana').val((CompParsed.CampanaTA.NroHectarea));
                $('#nroabolcampana').val((CompParsed.CampanaTA.NroArboles));
                $('#fechainiciocampana').val(CompParsed.CampanaTA.FechaInicio);
                $('#latitudcampana').val(CompParsed.CampanaTA.Latitud);
                $('#longitudcampana').val(CompParsed.CampanaTA.Longitud);


                $('#distritocampana').val(CompParsed.IdDistrito);

                detallesParsed.forEach(function (detalle) {
                    var campTA = {
                        idTipoArbol: detalle.IdTipoarbol,
                        nombreTipoarbol: detalle.TxtTipoarbol,
                        numarbol: detalle.NroArboles,
                        numhectareas: detalle.NroHectareas,
                        area: detalle.Area,
                        latitud: detalle.Latitud,
                        longitud: detalle.Longitud
                    };
                    CampanatipoArbol.push(campTA);
                });
                actualizarTablaTipoArbolSeleccionados();
            } else {
                document.getElementById("fechainiciocampana").value = returndatenowWithTime();

                // Configura los campos de fecha con la fecha actual en formato yyyy-MM-dd
                $(document).ready(function () {
                    // Manejador de cambio para el departamento


                    $('#departamentocampana').change(function () {
                        var departamentoId = $(this).val();

                        // Realiza una solicitud AJAX para obtener las provincias
                        $.ajax({
                            url: '/Pret01Predio/ObtenerProvincias', // Ajusta la URL según la estructura de tu aplicación
                            type: 'GET',
                            data: { departamentoId: departamentoId },
                            success: function (data) {
                                // Actualiza el contenido del select de provincia
                                $('#provinciacampana').empty();
                                $.each(data, function (index, item) {
                                    $('#provinciacampana').append($('<option>').text(item.txtDesc).attr('value', item.idProv));
                                });

                                // Llama al evento change para actualizar los distritos
                                $('#provinciacampana').change();
                            },
                            error: function () {
                                console.error('Error al obtener provincias.');
                            }
                        });
                    });

                    // Manejador de cambio para la provincia
                    $('#provinciacampana').change(function () {
                        var provinciaId = $(this).val();

                        // Realiza una solicitud AJAX para obtener los distritos
                        $.ajax({
                            url: '/Pret01Predio/ObtenerDistritos', // Ajusta la URL según la estructura de tu aplicación
                            type: 'GET',
                            data: { provinciaId: provinciaId },
                            success: function (data) {
                                // Actualiza el contenido del select de distrito
                                $('#distritocampana').empty();
                                $.each(data, function (index, item) {
                                    $('#distritocampana').append($('<option>').text(item.txtDesc).attr('value', item.idDist));
                                });
                            },
                            error: function () {
                                console.error('Error al obtener distritos.');
                            }
                        });
                    });
                });
            }





        });
    </script>


</body>
</html>


